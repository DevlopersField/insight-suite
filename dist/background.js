import{a as F}from"./assets/security-auditor-DwQwacN6.js";chrome.runtime.onMessage.addListener((i,p,m)=>{if(i.type==="ANALYZE_PAGE")return O(i.tabId).then(g=>m({type:"ANALYSIS_RESULT",data:g})).catch(g=>m({type:"ANALYSIS_ERROR",error:g instanceof Error?g.message:"Analysis failed"})),!0});async function O(i){var b;let p=i,m="";if(p)m=(await chrome.tabs.get(p)).url??"";else{const[c]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(c!=null&&c.id)||!(c!=null&&c.url))throw new Error("No active tab found");p=c.id,m=c.url}if(m.startsWith("chrome://")||m.startsWith("chrome-extension://")||m.startsWith("about:"))throw new Error("Cannot analyze browser internal pages. Navigate to a website first.");const g=await chrome.scripting.executeScript({target:{tabId:p},func:D,world:"MAIN"}),w=(b=g==null?void 0:g[0])==null?void 0:b.result;if(!w)throw new Error("Content script did not return results");const q=m.startsWith("http")?await F(m):[],A=[...w.links],S=Array.from(new Set(A.map(c=>c.href))).filter(c=>c&&typeof c=="string"&&c.toLowerCase().startsWith("http")).slice(0,50),x=await Promise.all(S.map(async c=>{try{const y=new AbortController,P=setTimeout(()=>y.abort(),5e3),k=await fetch(c,{method:"HEAD",mode:"no-cors",signal:y.signal});return clearTimeout(P),{url:c,status:k.status,statusText:k.statusText}}catch{return{url:c,status:0,statusText:"Error/Timeout"}}})),L=new Map(x.map(c=>[c.url,c])),E=A.map(c=>{const y=L.get(c.href);return y?{...c,status:y.status,statusText:y.statusText,isBroken:y.status>=400||y.status===0}:c});return{...w,links:E,security:q}}function D(){var v,N;function i(t,e){const r=document.querySelector(`meta[${t}="${e}"]`);return(r==null?void 0:r.getAttribute("content"))??""}const p=document.title??"",m=i("name","description"),g=((v=document.querySelector('link[rel="canonical"]'))==null?void 0:v.href)??"",w=i("name","robots")||"index, follow",q=i("name","author"),A=document.documentElement.lang??"",S=document.querySelector("meta[charset]"),x=(S==null?void 0:S.getAttribute("charset"))??"UTF-8",L=i("name","viewport"),E=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6")).map((t,e)=>({tag:t.tagName,text:(t.textContent??"").trim().slice(0,200),order:e+1})),j=Array.from((document.body||document).querySelectorAll("img")).map(t=>{var n;const e=t.src||t.getAttribute("data-src")||"";let r="unknown";try{const o=t.currentSrc||e;if(!o)r="none";else if(o.startsWith("data:")){const s=o.match(/^data:image\/([a-zA-Z0-9+-]+);/);r=s?s[1].split("+")[0].toLowerCase():"data"}else{const s=[/\.(webp|avif|png|jpg|jpeg|svg|gif|ico|bmp)(?:\?|#|$)/i,/[?&](?:format|fm|ext|type|output)=([^&?#]+)/i,/\/(webp|avif|png|jpg|jpeg|svg|gif|ico|bmp)(?:\/|$)/i];for(const l of s){const u=o.match(l);if(u&&u[1]){r=u[1].toLowerCase();break}}if(r==="unknown"){const l=t.closest("picture");if(l){const u=l.querySelector("source");u&&u.type&&(r=((n=u.type.split("/")[1])==null?void 0:n.split("+")[0].toLowerCase())||"unknown")}}if(r==="unknown"){const l=["webp","avif","png","jpg","jpeg","svg","gif","ico","bmp"],u=o.toLowerCase();for(const h of l)if(new RegExp(`\\b${h}\\b|\\.${h}`,"i").test(u)){r=h;break}}}}catch{r="err"}return r==="jpeg"&&(r="jpg"),r==="unknown"&&(r="img"),{src:e,alt:t.alt??"",title:t.title??"",width:t.naturalWidth||t.width||0,height:t.naturalHeight||t.height||0,type:r}}),b=Array.from(document.querySelectorAll("iframe")).map(t=>{const e=t.src||"";return e.includes("youtube.com")||e.includes("youtu.be")?{type:"youtube",url:e,hasSchema:!1,id:e.split("/").pop()||""}:e.includes("vimeo.com")?{type:"vimeo",url:e,hasSchema:!1,id:e.split("/").pop()||""}:null}).filter(Boolean),c=window.location.hostname,y=Array.from(document.querySelectorAll("a[href]")).map(t=>{const e=t;let r=!1;try{r=new URL(e.href,window.location.href).hostname!==c}catch{}return{href:e.href,text:(e.textContent??"").trim().slice(0,120),rel:e.rel??"",isExternal:r}}),P={ogTitle:i("property","og:title"),ogDescription:i("property","og:description"),ogImage:i("property","og:image"),ogUrl:i("property","og:url"),ogType:i("property","og:type"),twitterCard:i("name","twitter:card"),twitterTitle:i("name","twitter:title"),twitterDescription:i("name","twitter:description"),twitterImage:i("name","twitter:image"),twitterSite:i("name","twitter:site")},k=Array.from(document.querySelectorAll('script[type="application/ld+json"]')).flatMap(t=>{try{const e=JSON.parse(t.textContent||"");return(Array.isArray(e)?e:[e]).flatMap(n=>n["@graph"]&&Array.isArray(n["@graph"])?n["@graph"]:[n]).map(n=>{const o=n["@type"]||"unknown",s=[],l=[];return(o==="Article"||o==="NewsArticle"||o==="BlogPosting")&&!n.headline&&s.push("Missing headline"),o==="Product"&&!n.name&&s.push("Missing name"),{type:Array.isArray(o)?o.join(", "):o,data:n,isValid:s.length===0,errors:s,warnings:l}})}catch{return[]}});function a(t){try{return window[t]}catch{return}}function f(t){return Array.from(document.querySelectorAll("script[src]")).some(e=>e.src.includes(t))}function T(t){return Array.from(document.querySelectorAll("link[href]")).some(e=>e.href.includes(t))}function _(t){const e=document.querySelector('meta[name="generator"]');return e?(e.getAttribute("content")??"").toLowerCase().includes(t.toLowerCase()):!1}const R=[{name:"Next.js",category:"Framework",icon:"âš¡",detect:()=>a("__NEXT_DATA__")?98:f("/_next/")?90:document.getElementById("__next")?85:0},{name:"Nuxt.js",category:"Framework",icon:"ðŸ’š",detect:()=>a("__NUXT__")?95:document.getElementById("__nuxt")?85:0},{name:"Gatsby",category:"Framework",icon:"ðŸŸ£",detect:()=>document.getElementById("___gatsby")?92:0},{name:"React",category:"Library",icon:"âš›ï¸",detect:()=>a("React")||a("__REACT_DEVTOOLS_GLOBAL_HOOK__")?95:document.querySelector("[data-reactroot]")?90:0},{name:"Vue.js",category:"Library",icon:"ðŸŸ¢",detect:()=>{if(a("Vue")||a("__VUE__"))return 95;const t=document.querySelectorAll("*");for(const e of Array.from(t).slice(0,50))for(const r of Array.from(e.attributes))if(r.name.startsWith("data-v-"))return 85;return 0}},{name:"Angular",category:"Framework",icon:"ðŸ…°ï¸",detect:()=>{if(a("ng")||a("angular"))return 95;if(document.querySelector("[ng-app]"))return 90;const t=document.querySelectorAll("*");for(const e of Array.from(t).slice(0,50))for(const r of Array.from(e.attributes))if(r.name.startsWith("_ngcontent")||r.name.startsWith("_nghost"))return 85;return 0}},{name:"jQuery",category:"Library",icon:"ðŸ“œ",detect:()=>a("jQuery")?95:f("jquery")?85:0},{name:"WordPress",category:"CMS",icon:"ðŸ“",detect:()=>_("wordpress")?92:f("/wp-content/")||f("/wp-includes/")?90:T("/wp-content/")?88:document.querySelector('link[rel="https://api.w.org/"]')?85:0},{name:"Shopify",category:"E-commerce",icon:"ðŸ›ï¸",detect:()=>{var t;return(t=a("Shopify"))!=null&&t.shop?98:a("Shopify")?95:f("cdn.shopify.com")?92:T("cdn.shopify.com")||document.querySelector('meta[name="shopify-checkout-api-token"]')?90:0}},{name:"Shopify Theme",category:"E-commerce",icon:"ðŸŽ¨",detect:()=>{var e;const t=a("Shopify");return(e=t==null?void 0:t.theme)!=null&&e.name?95:t!=null&&t.theme?90:document.querySelector(".shopify-section")?80:0}},{name:"Wix",category:"CMS",icon:"ðŸ”²",detect:()=>a("wixBiSession")?95:_("wix")?90:0},{name:"Squarespace",category:"CMS",icon:"â¬›",detect:()=>a("SQUARESPACE_CONTEXT")?95:_("squarespace")?92:0},{name:"Webflow",category:"CMS",icon:"ðŸŒ",detect:()=>_("webflow")?95:document.querySelector("html.w-mod-js")?88:0},{name:"Tailwind CSS",category:"Styling",icon:"ðŸŽ¨",detect:()=>{var n,o;const t=((o=(n=document.body)==null?void 0:n.innerHTML)==null?void 0:o.slice(0,5e3))??"",r=["flex","mt-","p-","text-","bg-","rounded"].filter(s=>t.includes(s)).length;return r>=4?85:r>=2?60:0}},{name:"Bootstrap",category:"Styling",icon:"ðŸ…±ï¸",detect:()=>T("bootstrap")?90:f("bootstrap")?88:0},{name:"Google Analytics",category:"Analytics",icon:"ðŸ“Š",detect:()=>a("ga")||a("gtag")?95:a("dataLayer")?88:f("google-analytics.com")||f("googletagmanager.com")?90:0},{name:"Google Tag Manager",category:"Analytics",icon:"ðŸ·ï¸",detect:()=>a("google_tag_manager")?95:f("googletagmanager.com/gtm")?90:0},{name:"Facebook Pixel",category:"Analytics",icon:"ðŸ“˜",detect:()=>a("fbq")?95:f("connect.facebook.net")?90:0},{name:"Hotjar",category:"Analytics",icon:"ðŸ”¥",detect:()=>a("hj")?95:f("hotjar.com")?90:0},{name:"Stripe",category:"Payments",icon:"ðŸ’³",detect:()=>a("Stripe")?95:f("js.stripe.com")?92:0},{name:"PayPal",category:"Payments",icon:"ðŸ’°",detect:()=>a("paypal")?95:f("paypal.com/sdk")?92:0},{name:"Cloudflare",category:"CDN",icon:"â˜ï¸",detect:()=>document.querySelector("script[data-cf-beacon]")?90:f("cdnjs.cloudflare.com")?80:0}],C=[];for(const t of R)try{const e=t.detect();e>0&&C.push({name:t.name,category:t.category,confidence:e,icon:t.icon})}catch{}try{const t=a("Shopify");if((N=t==null?void 0:t.theme)!=null&&N.name){const e=C.find(r=>r.name==="Shopify Theme");e&&(e.name=`Shopify Theme: ${t.theme.name}`)}}catch{}C.sort((t,e)=>e.confidence-t.confidence);function M(t){return`https://fonts.google.com/specimen/${encodeURIComponent(t.trim())}`}const d=new Map;for(const t of Array.from(document.querySelectorAll('link[href*="fonts.googleapis.com"]')))try{const e=t.href,r=new URL(e),n=r.searchParams.getAll("family"),o=[];for(const s of n){const l=s.split(":")[0].replace(/\+/g," ").trim();l&&o.push(l)}if(o.length===0){const s=r.searchParams.get("family");if(s)for(const l of s.split("|")){const u=l.split(":")[0].replace(/\+/g," ").trim();u&&o.push(u)}}for(const s of o)d.has(s)||d.set(s,{family:s,source:"google",weights:[],styles:["normal"],url:M(s),cssUrl:e})}catch{}try{for(const t of Array.from(document.styleSheets)){let e;try{e=t.cssRules}catch{continue}for(const r of Array.from(e))if(r instanceof CSSFontFaceRule){const n=r.style.getPropertyValue("font-family").replace(/^["']|["']$/g,"").trim(),o=r.style.getPropertyValue("src"),s=r.style.getPropertyValue("font-weight")||"400",l=r.style.getPropertyValue("font-style")||"normal";if(!n)continue;const u=d.get(n);if(u)u.weights.includes(s)||u.weights.push(s),u.styles.includes(l)||u.styles.push(l);else{let h="custom";o.includes("fonts.gstatic.com")||o.includes("fonts.googleapis.com")?h="google":o.includes("typekit")&&(h="typekit");const W=o.match(/url\(["']?([^"')]+)["']?\)/);d.set(n,{family:n,source:h,weights:[s],styles:[l],url:h==="google"?M(n):null,cssUrl:W?W[1]:null})}}}}catch{}try{document.fonts&&document.fonts.forEach(t=>{const e=t.family.replace(/^["']|["']$/g,"").trim();if(!e)return;const r=d.get(e);if(r){const n=t.weight||"400",o=t.style||"normal";r.weights.includes(n)||r.weights.push(n),r.styles.includes(o)||r.styles.push(o)}})}catch{}const U=new Set(["Inter","Roboto","Open Sans","Lato","Montserrat","Poppins","Raleway","Oswald","Source Sans Pro","Nunito","Playfair Display","Merriweather","Ubuntu","Noto Sans","PT Sans","Rubik","Work Sans","Fira Sans","Quicksand","Barlow","Mulish","DM Sans","Outfit","Space Grotesk","Plus Jakarta Sans","Manrope","JetBrains Mono","Fira Code","Source Code Pro","IBM Plex Sans","Lexend","Geist"]),I=[document.body,document.querySelector("h1"),document.querySelector("h2"),document.querySelector("p")].filter(Boolean);for(const t of I)try{const e=getComputedStyle(t).fontFamily;if(!e)continue;for(const r of e.split(",")){const n=r.trim().replace(/^["']|["']$/g,"");if(!n||d.has(n))continue;const o=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],s=U.has(n);d.set(n,{family:n,source:s?"google":"system",weights:[getComputedStyle(t).fontWeight||"400"],styles:[getComputedStyle(t).fontStyle||"normal"],url:s?M(n):null,cssUrl:null})}}catch{}const B=Array.from(d.values());return{url:window.location.href,title:p,titleLength:p.length,description:m,descriptionLength:m.length,canonical:g,robots:w,author:q,language:A,charset:x,viewport:L,headers:E,images:j,links:y,social:P,tech:C,fonts:B,videos:b,schemas:k}}

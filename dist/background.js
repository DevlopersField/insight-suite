import{auditSecurityHeaders as F}from"./assets/security-auditor-DNRbVKQW.js";chrome.runtime.onMessage.addListener((c,m,u)=>{if(c.type==="ANALYZE_PAGE")return O(c.tabId).then(f=>u({type:"ANALYSIS_RESULT",data:f})).catch(f=>u({type:"ANALYSIS_ERROR",error:f instanceof Error?f.message:"Analysis failed"})),!0});async function O(c){var h;let m=c,u="";if(m)u=(await chrome.tabs.get(m)).url??"";else{const[l]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(l!=null&&l.id)||!(l!=null&&l.url))throw new Error("No active tab found");m=l.id,u=l.url}if(u.startsWith("chrome://")||u.startsWith("chrome-extension://")||u.startsWith("about:"))throw new Error("Cannot analyze browser internal pages. Navigate to a website first.");const f=await chrome.scripting.executeScript({target:{tabId:m},func:B,world:"MAIN"}),p=(h=f==null?void 0:f[0])==null?void 0:h.result;if(!p)throw new Error("Content script did not return results");const _=await F(u);return{...p,security:_}}function B(){var k,E;function c(t,e){const r=document.querySelector(`meta[${t}="${e}"]`);return(r==null?void 0:r.getAttribute("content"))??""}const m=document.title??"",u=c("name","description"),f=((k=document.querySelector('link[rel="canonical"]'))==null?void 0:k.href)??"",p=c("name","robots")||"index, follow",_=c("name","author"),C=document.documentElement.lang??"",h=document.querySelector("meta[charset]"),l=(h==null?void 0:h.getAttribute("charset"))??"UTF-8",x=c("name","viewport"),L=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6")).map((t,e)=>({tag:t.tagName,text:(t.textContent??"").trim().slice(0,200),order:e+1})),T=Array.from(document.querySelectorAll("img")).map(t=>({src:t.src||t.getAttribute("data-src")||"",alt:t.alt??"",title:t.title??"",width:t.naturalWidth||t.width||0,height:t.naturalHeight||t.height||0})),M=window.location.hostname,N=Array.from(document.querySelectorAll("a[href]")).map(t=>{const e=t;let r=!1;try{r=new URL(e.href,window.location.href).hostname!==M}catch{}return{href:e.href,text:(e.textContent??"").trim().slice(0,120),rel:e.rel??"",isExternal:r}}),R={ogTitle:c("property","og:title"),ogDescription:c("property","og:description"),ogImage:c("property","og:image"),ogUrl:c("property","og:url"),ogType:c("property","og:type"),twitterCard:c("name","twitter:card"),twitterTitle:c("name","twitter:title"),twitterDescription:c("name","twitter:description"),twitterImage:c("name","twitter:image"),twitterSite:c("name","twitter:site")};function n(t){try{return window[t]}catch{return}}function s(t){return Array.from(document.querySelectorAll("script[src]")).some(e=>e.src.includes(t))}function b(t){return Array.from(document.querySelectorAll("link[href]")).some(e=>e.href.includes(t))}function S(t){const e=document.querySelector('meta[name="generator"]');return e?(e.getAttribute("content")??"").toLowerCase().includes(t.toLowerCase()):!1}const U=[{name:"Next.js",category:"Framework",icon:"âš¡",detect:()=>n("__NEXT_DATA__")?98:s("/_next/")?90:document.getElementById("__next")?85:0},{name:"Nuxt.js",category:"Framework",icon:"ðŸ’š",detect:()=>n("__NUXT__")?95:document.getElementById("__nuxt")?85:0},{name:"Gatsby",category:"Framework",icon:"ðŸŸ£",detect:()=>document.getElementById("___gatsby")?92:0},{name:"React",category:"Library",icon:"âš›ï¸",detect:()=>n("React")||n("__REACT_DEVTOOLS_GLOBAL_HOOK__")?95:document.querySelector("[data-reactroot]")?90:0},{name:"Vue.js",category:"Library",icon:"ðŸŸ¢",detect:()=>{if(n("Vue")||n("__VUE__"))return 95;const t=document.querySelectorAll("*");for(const e of Array.from(t).slice(0,50))for(const r of Array.from(e.attributes))if(r.name.startsWith("data-v-"))return 85;return 0}},{name:"Angular",category:"Framework",icon:"ðŸ…°ï¸",detect:()=>{if(n("ng")||n("angular"))return 95;if(document.querySelector("[ng-app]"))return 90;const t=document.querySelectorAll("*");for(const e of Array.from(t).slice(0,50))for(const r of Array.from(e.attributes))if(r.name.startsWith("_ngcontent")||r.name.startsWith("_nghost"))return 85;return 0}},{name:"jQuery",category:"Library",icon:"ðŸ“œ",detect:()=>n("jQuery")?95:s("jquery")?85:0},{name:"WordPress",category:"CMS",icon:"ðŸ“",detect:()=>S("wordpress")?92:s("/wp-content/")||s("/wp-includes/")?90:b("/wp-content/")?88:document.querySelector('link[rel="https://api.w.org/"]')?85:0},{name:"Shopify",category:"E-commerce",icon:"ðŸ›ï¸",detect:()=>{var t;return(t=n("Shopify"))!=null&&t.shop?98:n("Shopify")?95:s("cdn.shopify.com")?92:b("cdn.shopify.com")||document.querySelector('meta[name="shopify-checkout-api-token"]')?90:0}},{name:"Shopify Theme",category:"E-commerce",icon:"ðŸŽ¨",detect:()=>{var e;const t=n("Shopify");return(e=t==null?void 0:t.theme)!=null&&e.name?95:t!=null&&t.theme?90:document.querySelector(".shopify-section")?80:0}},{name:"Wix",category:"CMS",icon:"ðŸ”²",detect:()=>n("wixBiSession")?95:S("wix")?90:0},{name:"Squarespace",category:"CMS",icon:"â¬›",detect:()=>n("SQUARESPACE_CONTEXT")?95:S("squarespace")?92:0},{name:"Webflow",category:"CMS",icon:"ðŸŒ",detect:()=>S("webflow")?95:document.querySelector("html.w-mod-js")?88:0},{name:"Tailwind CSS",category:"Styling",icon:"ðŸŽ¨",detect:()=>{var o,i;const t=((i=(o=document.body)==null?void 0:o.innerHTML)==null?void 0:i.slice(0,5e3))??"",r=["flex","mt-","p-","text-","bg-","rounded"].filter(a=>t.includes(a)).length;return r>=4?85:r>=2?60:0}},{name:"Bootstrap",category:"Styling",icon:"ðŸ…±ï¸",detect:()=>b("bootstrap")?90:s("bootstrap")?88:0},{name:"Google Analytics",category:"Analytics",icon:"ðŸ“Š",detect:()=>n("ga")||n("gtag")?95:n("dataLayer")?88:s("google-analytics.com")||s("googletagmanager.com")?90:0},{name:"Google Tag Manager",category:"Analytics",icon:"ðŸ·ï¸",detect:()=>n("google_tag_manager")?95:s("googletagmanager.com/gtm")?90:0},{name:"Facebook Pixel",category:"Analytics",icon:"ðŸ“˜",detect:()=>n("fbq")?95:s("connect.facebook.net")?90:0},{name:"Hotjar",category:"Analytics",icon:"ðŸ”¥",detect:()=>n("hj")?95:s("hotjar.com")?90:0},{name:"Stripe",category:"Payments",icon:"ðŸ’³",detect:()=>n("Stripe")?95:s("js.stripe.com")?92:0},{name:"PayPal",category:"Payments",icon:"ðŸ’°",detect:()=>n("paypal")?95:s("paypal.com/sdk")?92:0},{name:"Cloudflare",category:"CDN",icon:"â˜ï¸",detect:()=>document.querySelector("script[data-cf-beacon]")?90:s("cdnjs.cloudflare.com")?80:0}],w=[];for(const t of U)try{const e=t.detect();e>0&&w.push({name:t.name,category:t.category,confidence:e,icon:t.icon})}catch{}try{const t=n("Shopify");if((E=t==null?void 0:t.theme)!=null&&E.name){const e=w.find(r=>r.name==="Shopify Theme");e&&(e.name=`Shopify Theme: ${t.theme.name}`)}}catch{}w.sort((t,e)=>e.confidence-t.confidence);function q(t){return`https://fonts.google.com/specimen/${encodeURIComponent(t.trim())}`}const y=new Map;for(const t of Array.from(document.querySelectorAll('link[href*="fonts.googleapis.com"]')))try{const e=t.href,r=new URL(e),o=r.searchParams.getAll("family"),i=[];for(const a of o){const g=a.split(":")[0].replace(/\+/g," ").trim();g&&i.push(g)}if(i.length===0){const a=r.searchParams.get("family");if(a)for(const g of a.split("|")){const d=g.split(":")[0].replace(/\+/g," ").trim();d&&i.push(d)}}for(const a of i)y.has(a)||y.set(a,{family:a,source:"google",weights:[],styles:["normal"],url:q(a),cssUrl:e})}catch{}try{for(const t of Array.from(document.styleSheets)){let e;try{e=t.cssRules}catch{continue}for(const r of Array.from(e))if(r instanceof CSSFontFaceRule){const o=r.style.getPropertyValue("font-family").replace(/^["']|["']$/g,"").trim(),i=r.style.getPropertyValue("src"),a=r.style.getPropertyValue("font-weight")||"400",g=r.style.getPropertyValue("font-style")||"normal";if(!o)continue;const d=y.get(o);if(d)d.weights.includes(a)||d.weights.push(a),d.styles.includes(g)||d.styles.push(g);else{let A="custom";i.includes("fonts.gstatic.com")||i.includes("fonts.googleapis.com")?A="google":i.includes("typekit")&&(A="typekit");const P=i.match(/url\(["']?([^"')]+)["']?\)/);y.set(o,{family:o,source:A,weights:[a],styles:[g],url:A==="google"?q(o):null,cssUrl:P?P[1]:null})}}}}catch{}try{document.fonts&&document.fonts.forEach(t=>{const e=t.family.replace(/^["']|["']$/g,"").trim();if(!e)return;const r=y.get(e);if(r){const o=t.weight||"400",i=t.style||"normal";r.weights.includes(o)||r.weights.push(o),r.styles.includes(i)||r.styles.push(i)}})}catch{}const W=new Set(["Inter","Roboto","Open Sans","Lato","Montserrat","Poppins","Raleway","Oswald","Source Sans Pro","Nunito","Playfair Display","Merriweather","Ubuntu","Noto Sans","PT Sans","Rubik","Work Sans","Fira Sans","Quicksand","Barlow","Mulish","DM Sans","Outfit","Space Grotesk","Plus Jakarta Sans","Manrope","JetBrains Mono","Fira Code","Source Code Pro","IBM Plex Sans","Lexend","Geist"]),I=[document.body,document.querySelector("h1"),document.querySelector("h2"),document.querySelector("p")].filter(Boolean);for(const t of I)try{const e=getComputedStyle(t).fontFamily;if(!e)continue;for(const r of e.split(",")){const o=r.trim().replace(/^["']|["']$/g,"");if(!o||y.has(o))continue;const i=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],a=W.has(o);y.set(o,{family:o,source:a?"google":"system",weights:[getComputedStyle(t).fontWeight||"400"],styles:[getComputedStyle(t).fontStyle||"normal"],url:a?q(o):null,cssUrl:null})}}catch{}const j=Array.from(y.values());return{url:window.location.href,title:m,titleLength:m.length,description:u,descriptionLength:u.length,canonical:f,robots:p,author:_,language:C,charset:l,viewport:x,headers:L,images:T,links:N,social:R,tech:w,fonts:j}}
